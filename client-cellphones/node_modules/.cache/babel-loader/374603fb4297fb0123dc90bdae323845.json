{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import ARGuide from'../ARGuide/ARGuide';import'./ARViewer.css';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";function ARViewer(_ref){let{product}=_ref;const[isARMode,setIsARMode]=useState(false);const[isVRMode,setIsVRMode]=useState(false);const[simple3DMode,setSimple3DMode]=useState(false);// No marker required\nconst[currentView,setCurrentView]=useState('exterior');const[markerType,setMarkerType]=useState('preset');// 'preset' or 'pattern'\nconst[markerPreset,setMarkerPreset]=useState('hiro');const[markerPatternUrl,setMarkerPatternUrl]=useState('');const[isLoading,setIsLoading]=useState(false);const[error,setError]=useState('');const[objectRotation,setObjectRotation]=useState({x:0,y:0});const[librariesLoaded,setLibrariesLoaded]=useState(false);const[showGuide,setShowGuide]=useState(false);// Camera/device states\nconst[hasCameraPermission,setHasCameraPermission]=useState(false);const[cameraFacing,setCameraFacing]=useState('environment');// 'environment' | 'user'\nconst[devices,setDevices]=useState([]);// MediaDeviceInfo[]\nconst[selectedDeviceId,setSelectedDeviceId]=useState('');const[showCameraTest,setShowCameraTest]=useState(false);const testVideoRef=useRef(null);let testStream=useRef(null);// Check if A-Frame and AR.js are loaded\nuseEffect(()=>{const checkLibraries=()=>{const aframeLoaded=!!window.AFRAME;const arjsLoaded=!!(window.THREEx&&window.THREEx.ArToolkitSource);if(aframeLoaded&&arjsLoaded){setLibrariesLoaded(true);console.log('AR/VR libraries loaded successfully');}else{setTimeout(checkLibraries,100);}};checkLibraries();},[]);// Enumerate devices after permission granted\nconst enumerateCameras=async()=>{try{const devs=await navigator.mediaDevices.enumerateDevices();const cams=devs.filter(d=>d.kind==='videoinput');setDevices(cams);if(cams.length&&!selectedDeviceId){setSelectedDeviceId(cams[0].deviceId);}}catch(err){console.warn('enumerateDevices failed:',err);}};useEffect(()=>{if(hasCameraPermission){enumerateCameras();}},[hasCameraPermission]);// Toggle simple camera test preview\nconst startTestPreview=async()=>{try{if(testStream.current)return;// already running\nconst constraints=selectedDeviceId?{video:{deviceId:{exact:selectedDeviceId}}}:{video:{facingMode:cameraFacing}};const stream=await navigator.mediaDevices.getUserMedia(constraints);testStream.current=stream;if(testVideoRef.current){testVideoRef.current.srcObject=stream;await testVideoRef.current.play().catch(()=>{});}}catch(e){setError('Kh√¥ng m·ªü ƒë∆∞·ª£c camera test: '+e.message);}};const stopTestPreview=()=>{if(testStream.current){testStream.current.getTracks().forEach(t=>t.stop());testStream.current=null;}};useEffect(()=>{if(showCameraTest)startTestPreview();else stopTestPreview();return()=>stopTestPreview();},[showCameraTest,selectedDeviceId,cameraFacing]);// Build AR.js attribute string with selected camera/facing\nconst arjsConfig=React.useMemo(()=>{const parts=['sourceType: webcam','debugUIEnabled: true','detectionMode: mono',// Keep videoTexture off for max compatibility, let video sit behind canvas\n// 'videoTexture: true',\n'sourceWidth: 1280','sourceHeight: 720','displayWidth: 1280','displayHeight: 720'];if(selectedDeviceId)parts.push(\"sourceId: \".concat(selectedDeviceId));if(!selectedDeviceId&&cameraFacing)parts.push(\"facingMode: \".concat(cameraFacing));return parts.join('; ');},[selectedDeviceId,cameraFacing]);// L·∫•y th√¥ng tin s·∫£n ph·∫©m th·ª±c t·∫ø t·ª´ props\nconst getProductComponents=product=>{const baseComponents={exterior:[{name:'M√†n h√¨nh',color:'#000000',position:{x:0,y:0,z:0},size:40},{name:'Khung m√°y',color:'#C0C0C0',position:{x:0,y:0,z:-1},size:35},{name:'Camera',color:'#FF0000',position:{x:0,y:0.5,z:0.5},size:15},{name:'N√∫t ngu·ªìn',color:'#808080',position:{x:0.3,y:0,z:0},size:10},{name:'Speaker',color:'#333333',position:{x:-0.3,y:0,z:0},size:12}],interior:[{name:'CPU',color:'#00FF00',position:{x:0,y:0,z:0},size:25},{name:'RAM',color:'#0000FF',position:{x:0.2,y:0,z:0},size:20},{name:'Storage',color:'#FFFF00',position:{x:-0.2,y:0,z:0},size:18},{name:'Battery',color:'#FF00FF',position:{x:0,y:-0.3,z:0},size:30},{name:'Motherboard',color:'#00FFFF',position:{x:0,y:0,z:-0.1},size:35}],exploded:[{name:'Screen Assembly',color:'#000000',position:{x:0,y:0.5,z:0},size:45},{name:'Main Board',color:'#00FF00',position:{x:0,y:0,z:0},size:40},{name:'Battery Pack',color:'#FF00FF',position:{x:0,y:-0.5,z:0},size:35},{name:'Camera Module',color:'#FF0000',position:{x:0.3,y:0.3,z:0.3},size:15},{name:'Speaker',color:'#808080',position:{x:-0.3,y:0.3,z:0.3},size:12}]};// N·∫øu ch∆∞a c√≥ product th·∫≠t, d√πng d·ªØ li·ªáu m·∫´u\nif(!product){return{name:\"\".concat(currentView==='exterior'?'Exterior':currentView==='interior'?'Interior':'Exploded',\" View\"),description:\"Xem \".concat(currentView==='exterior'?'b√™n ngo√†i':currentView==='interior'?'b√™n trong':'c√°c b·ªô ph·∫≠n t√°ch r·ªùi',\" c\\u1EE7a s\\u1EA3n ph\\u1EA9m m\\u1EABu\"),components:baseComponents[currentView]};}// N·∫øu c√≥ product th·∫≠t\nreturn{name:\"\".concat(currentView==='exterior'?'Exterior':currentView==='interior'?'Interior':'Exploded',\" View\"),description:\"Xem \".concat(currentView==='exterior'?'b√™n ngo√†i':currentView==='interior'?'b√™n trong':'c√°c b·ªô ph·∫≠n t√°ch r·ªùi',\" c\\u1EE7a \").concat(product.name),components:baseComponents[currentView]};};const currentModelData=getProductComponents(product);const startAR=async()=>{if(!librariesLoaded){setError('Th∆∞ vi·ªán AR/VR ch∆∞a ƒë∆∞·ª£c t·∫£i. Vui l√≤ng ƒë·ª£i...');return;}// Ensure test preview is stopped so AR.js can access the camera\nif(showCameraTest){setShowCameraTest(false);stopTestPreview();}setIsLoading(true);setError('');try{const constraints=selectedDeviceId?{video:{deviceId:{exact:selectedDeviceId}}}:{video:{facingMode:cameraFacing}};const stream=await navigator.mediaDevices.getUserMedia(constraints);stream.getTracks().forEach(t=>t.stop());setHasCameraPermission(true);await enumerateCameras();setIsARMode(true);setIsVRMode(false);// Give AR.js a tick to attach video, then force a resize\nsetTimeout(()=>{try{window.dispatchEvent(new Event('resize'));}catch(_unused){}},300);}catch(error){if(error.name==='NotAllowedError'){setError('Vui l√≤ng cho ph√©p truy c·∫≠p camera ƒë·ªÉ s·ª≠ d·ª•ng AR');}else if(error.name==='NotFoundError'||error.name==='OverconstrainedError'){setError('Kh√¥ng t√¨m th·∫•y camera ph√π h·ª£p. H√£y th·ª≠ ƒë·ªïi ngu·ªìn camera.');}else{setError('L·ªói kh·ªüi t·∫°o AR: '+error.message);}}setIsLoading(false);};const startVR=async()=>{if(!librariesLoaded){setError('Th∆∞ vi·ªán AR/VR ch∆∞a ƒë∆∞·ª£c t·∫£i. Vui l√≤ng ƒë·ª£i...');return;}// Stop camera test if running\nif(showCameraTest){setShowCameraTest(false);stopTestPreview();}setIsLoading(true);setError('');try{setIsVRMode(true);setIsARMode(false);setTimeout(()=>{try{window.dispatchEvent(new Event('resize'));}catch(_unused2){}},300);}catch(error){setError('L·ªói kh·ªüi t·∫°o VR: '+error.message);}setIsLoading(false);};const exitARVR=()=>{setIsARMode(false);setIsVRMode(false);setError('');};const handlePatternFileUpload=event=>{const file=event.target.files&&event.target.files[0];if(file){if(file.name.endsWith('.patt')){const reader=new FileReader();reader.onload=e=>{const dataUrl=e.target.result;setMarkerPatternUrl(dataUrl);setError('');};reader.onerror=()=>{setError('L·ªói khi ƒë·ªçc file pattern');};reader.readAsDataURL(file);}else{setError('Vui l√≤ng ch·ªçn file c√≥ ƒë·ªãnh d·∫°ng .patt');}}};return/*#__PURE__*/_jsxs(\"div\",{className:\"ar-viewer\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"ar-viewer-header\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"AR/VR Viewer - \",(product===null||product===void 0?void 0:product.name)||'S·∫£n ph·∫©m']}),/*#__PURE__*/_jsx(\"p\",{children:\"Xem c\\u1EA5u tr\\xFAc thi\\u1EBFt b\\u1ECB v\\u1EDBi c\\xF4ng ngh\\u1EC7 AR/VR\"}),/*#__PURE__*/_jsx(\"button\",{className:\"guide-button\",onClick:()=>setShowGuide(true),children:\"\\uD83D\\uDCDA H\\u01B0\\u1EDBng d\\u1EABn s\\u1EED d\\u1EE5ng\"})]}),!librariesLoaded&&/*#__PURE__*/_jsxs(\"div\",{className:\"library-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u0110ang t\\u1EA3i th\\u01B0 vi\\u1EC7n AR/VR...\"})]}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"error-icon\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsx(\"span\",{children:error})]}),!isARMode&&!isVRMode?/*#__PURE__*/_jsxs(\"div\",{className:\"ar-viewer-controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"view-modes\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Ch\\u1ECDn ch\\u1EBF \\u0111\\u1ED9 xem:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mode-buttons\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"mode-btn \".concat(currentView==='exterior'?'active':''),onClick:()=>setCurrentView('exterior'),children:[/*#__PURE__*/_jsx(\"span\",{className:\"mode-icon\",children:\"\\uD83D\\uDCF1\"}),\"B\\xEAn ngo\\xE0i\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"mode-btn \".concat(currentView==='interior'?'active':''),onClick:()=>setCurrentView('interior'),children:[/*#__PURE__*/_jsx(\"span\",{className:\"mode-icon\",children:\"\\uD83D\\uDD27\"}),\"B\\xEAn trong\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"mode-btn \".concat(currentView==='exploded'?'active':''),onClick:()=>setCurrentView('exploded'),children:[/*#__PURE__*/_jsx(\"span\",{className:\"mode-icon\",children:\"\\uD83D\\uDCA5\"}),\"T\\xE1ch r\\u1EDDi\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ar-vr-buttons\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"marker-controls\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"View: \"}),/*#__PURE__*/_jsxs(\"select\",{value:currentView,onChange:e=>setCurrentView(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"exterior\",children:\"Exterior view\"}),/*#__PURE__*/_jsx(\"option\",{value:\"interior\",children:\"Interior view\"}),/*#__PURE__*/_jsx(\"option\",{value:\"exploded\",children:\"Exploded view\"})]}),/*#__PURE__*/_jsx(\"label\",{style:{marginLeft:12},children:\"Marker type:\"}),/*#__PURE__*/_jsxs(\"select\",{value:markerType,onChange:e=>setMarkerType(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"preset\",children:\"Preset (hiro)\"}),/*#__PURE__*/_jsx(\"option\",{value:\"pattern\",children:\"Upload pattern (.patt)\"})]}),markerType==='preset'&&/*#__PURE__*/_jsxs(\"select\",{value:markerPreset,onChange:e=>setMarkerPreset(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"hiro\",children:\"hiro\"}),/*#__PURE__*/_jsx(\"option\",{value:\"kanji\",children:\"kanji\"})]}),markerType==='pattern'&&/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".patt\",onChange:handlePatternFileUpload})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"marker-controls\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Camera:\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedDeviceId,onChange:e=>setSelectedDeviceId(e.target.value),disabled:!devices.length,children:devices.length===0?/*#__PURE__*/_jsx(\"option\",{children:\"Kh\\xF4ng ph\\xE1t hi\\u1EC7n camera\"}):devices.map((d,i)=>/*#__PURE__*/_jsx(\"option\",{value:d.deviceId,children:d.label||\"Camera \".concat(i+1)},d.deviceId||i))}),/*#__PURE__*/_jsx(\"label\",{style:{marginLeft:12},children:\"H\\u01B0\\u1EDBng camera:\"}),/*#__PURE__*/_jsxs(\"select\",{value:cameraFacing,onChange:e=>setCameraFacing(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"environment\",children:\"Sau (environment)\"}),/*#__PURE__*/_jsx(\"option\",{value:\"user\",children:\"Tr\\u01B0\\u1EDBc (user)\"})]}),/*#__PURE__*/_jsx(\"label\",{style:{marginLeft:12},children:\"Test camera:\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ar-btn\",style:{padding:'8px 12px'},onClick:()=>setShowCameraTest(v=>!v),children:showCameraTest?'T·∫Øt test':'M·ªü test'})]}),showCameraTest&&/*#__PURE__*/_jsx(\"div\",{style:{background:'#000',borderRadius:8,overflow:'hidden',border:'1px solid #333',maxWidth:600,margin:'0 auto'},children:/*#__PURE__*/_jsx(\"video\",{ref:testVideoRef,autoPlay:true,playsInline:true,muted:true,style:{width:'100%',height:300,objectFit:'cover'}})}),/*#__PURE__*/_jsxs(\"button\",{className:\"ar-btn\",onClick:startAR,disabled:isLoading||!librariesLoaded,children:[/*#__PURE__*/_jsx(\"span\",{className:\"btn-icon\",children:\"\\uD83D\\uDCF7\"}),isLoading?'ƒêang kh·ªüi t·∫°o...':!librariesLoaded?'ƒêang t·∫£i...':'B·∫Øt ƒë·∫ßu AR']}),/*#__PURE__*/_jsxs(\"button\",{className:\"vr-btn\",onClick:startVR,disabled:isLoading||!librariesLoaded,children:[/*#__PURE__*/_jsx(\"span\",{className:\"btn-icon\",children:\"\\uD83E\\uDD7D\"}),!librariesLoaded?'ƒêang t·∫£i...':'B·∫Øt ƒë·∫ßu VR']})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"model-preview\",children:[/*#__PURE__*/_jsx(\"h3\",{children:currentModelData.name}),/*#__PURE__*/_jsx(\"p\",{children:currentModelData.description}),/*#__PURE__*/_jsx(\"div\",{className:\"components-list\",children:currentModelData.components.map((component,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"component-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"component-color\",style:{backgroundColor:component.color}}),/*#__PURE__*/_jsx(\"span\",{children:component.name})]},index))}),/*#__PURE__*/_jsxs(\"div\",{className:\"marker-preview\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Marker d\\xF9ng \\u0111\\u1EC3 th\\u1EED (hiro)\"}),/*#__PURE__*/_jsx(\"p\",{children:\"In ho\\u1EB7c hi\\u1EC3n th\\u1ECB marker n\\xE0y \\u0111\\u1EC3 camera c\\xF3 th\\u1EC3 nh\\u1EADn di\\u1EC7n v\\xE0 hi\\u1EC3n th\\u1ECB m\\xF4 h\\xECnh.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"marker-image-wrap\",children:/*#__PURE__*/_jsx(\"img\",{alt:\"hiro marker\",src:\"https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png\",style:{width:150,height:150,border:'1px solid #ccc'}})}),/*#__PURE__*/_jsx(\"a\",{className:\"download-marker\",href:\"https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png\",target:\"_blank\",rel:\"noreferrer\",children:\"T\\u1EA3i marker (m\\u1EDF \\u1EA3nh)\"})]})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"ar-vr-viewport\",children:[isARMode&&/*#__PURE__*/_jsx(\"div\",{className:\"ar-viewport aframe-wrapper\",children:/*#__PURE__*/_jsxs(\"a-scene\",{embedded:true,renderer:\"antialias: true; colorManagement: true; alpha: true; precision: medium;\",arjs:arjsConfig,\"vr-mode-ui\":\"enabled: false\",\"device-orientation-permission-ui\":\"enabled: false\",children:[/*#__PURE__*/_jsx(\"a-assets\",{children:(product===null||product===void 0?void 0:product.modelUrl)&&/*#__PURE__*/_jsx(\"a-asset-item\",{id:\"productModel\",src:product.modelUrl})}),/*#__PURE__*/_jsx(\"a-light\",{type:\"ambient\",color:\"#606060\",intensity:\"0.4\"}),/*#__PURE__*/_jsx(\"a-light\",{type:\"directional\",position:\"0 1 0\",rotation:\"-90 0 0\",intensity:\"0.6\"}),markerType==='preset'?/*#__PURE__*/_jsx(\"a-marker\",{preset:markerPreset,raycaster:\"objects: .clickable\",emitevents:\"true\",cursor:\"fuse: false; rayOrigin: mouse;\",children:/*#__PURE__*/_jsxs(\"a-entity\",{id:\"phone-model\",position:\"0 0 0\",children:[currentModelData.components.map((component,index)=>{const pos=component.position;const size=component.size*0.01;// Scale down\nreturn/*#__PURE__*/_jsx(\"a-box\",{position:\"\".concat(pos.x,\" \").concat(pos.y+0.5,\" \").concat(pos.z),width:size,height:size,depth:size,color:component.color,class:\"clickable\",animation:\"property: rotation; to: 0 360 0; loop: true; dur: 10000\"},index);}),(product===null||product===void 0?void 0:product.modelUrl)?/*#__PURE__*/_jsx(\"a-entity\",{\"gltf-model\":\"#productModel\",scale:\"0.5 0.5 0.5\",position:\"0 0 0\"}):/*#__PURE__*/_jsx(\"a-box\",{position:\"0 0.5 0\",depth:\"0.4\",height:\"0.6\",width:\"0.3\",color:\"#4CC3D9\",rotation:\"0 45 0\"}),/*#__PURE__*/_jsx(\"a-text\",{value:\"\".concat((product===null||product===void 0?void 0:product.name)||'S·∫£n ph·∫©m',\" - \").concat(currentView),align:\"center\",position:\"0 -0.8 0\",color:\"#FFFFFF\",width:\"4\",geometry:\"primitive: plane; width: 2; height: auto\",material:\"color: #000000; opacity: 0.7\"})]})}):markerPatternUrl?/*#__PURE__*/_jsx(\"a-marker\",{type:\"pattern\",url:markerPatternUrl,raycaster:\"objects: .clickable\",emitevents:\"true\",children:/*#__PURE__*/_jsxs(\"a-entity\",{id:\"phone-model\",position:\"0 0 0\",children:[currentModelData.components.map((component,index)=>{const pos=component.position;const size=component.size*0.01;return/*#__PURE__*/_jsx(\"a-box\",{position:\"\".concat(pos.x,\" \").concat(pos.y+0.5,\" \").concat(pos.z),width:size,height:size,depth:size,color:component.color,class:\"clickable\"},index);}),(product===null||product===void 0?void 0:product.modelUrl)?/*#__PURE__*/_jsx(\"a-entity\",{\"gltf-model\":\"#productModel\",scale:\"0.5 0.5 0.5\",position:\"0 0 0\"}):/*#__PURE__*/_jsx(\"a-box\",{position:\"0 0.5 0\",depth:\"0.4\",height:\"0.6\",width:\"0.3\",color:\"#4CC3D9\",rotation:\"0 45 0\"}),/*#__PURE__*/_jsx(\"a-text\",{value:\"\".concat((product===null||product===void 0?void 0:product.name)||'S·∫£n ph·∫©m',\" - \").concat(currentView),align:\"center\",position:\"0 -0.8 0\",color:\"#FFFFFF\",width:\"4\"})]})}):/*#__PURE__*/_jsx(\"a-entity\",{children:/*#__PURE__*/_jsx(\"a-text\",{value:\"Vui l\\xF2ng upload file .patt \\u0111\\u1EC3 s\\u1EED d\\u1EE5ng marker pattern\",align:\"center\",position:\"0 0 -3\",color:\"#FF0000\",width:\"4\"})}),/*#__PURE__*/_jsx(\"a-entity\",{camera:true,\"look-controls-enabled\":\"false\",cursor:\"rayOrigin: mouse\"})]})}),isVRMode&&/*#__PURE__*/_jsx(\"div\",{className:\"vr-viewport aframe-wrapper\",children:/*#__PURE__*/_jsxs(\"a-scene\",{embedded:true,renderer:\"antialias: true; colorManagement: true; precision: medium;\",background:\"color: #87CEEB\",\"device-orientation-permission-ui\":\"enabled: false\",children:[/*#__PURE__*/_jsx(\"a-assets\",{children:(product===null||product===void 0?void 0:product.modelUrl)&&/*#__PURE__*/_jsx(\"a-asset-item\",{id:\"productModelVr\",src:product.modelUrl})}),/*#__PURE__*/_jsx(\"a-light\",{type:\"ambient\",color:\"#404040\",intensity:\"0.4\"}),/*#__PURE__*/_jsx(\"a-light\",{type:\"directional\",position:\"2 4 5\",intensity:\"0.6\"}),/*#__PURE__*/_jsxs(\"a-entity\",{id:\"phone-container\",position:\"0 1.6 -3\",rotation:\"0 0 0\",children:[currentModelData.components.map((component,index)=>{const pos=component.position;const size=component.size*0.02;return/*#__PURE__*/_jsx(\"a-box\",{position:\"\".concat(pos.x,\" \").concat(pos.y,\" \").concat(pos.z),width:size,height:size,depth:size,color:component.color,animation:\"property: rotation; to: 0 360 0; loop: true; dur: \".concat(8000+index*1000),class:\"clickable\"},index);}),/*#__PURE__*/_jsx(\"a-text\",{value:\"\".concat((product===null||product===void 0?void 0:product.name)||'S·∫£n ph·∫©m',\" - \").concat(currentView,\" View\"),align:\"center\",position:\"0 -1 0\",color:\"#FFFFFF\",width:\"6\",geometry:\"primitive: plane; width: 3; height: auto\",material:\"color: #000000; opacity: 0.8\"})]}),/*#__PURE__*/_jsx(\"a-plane\",{position:\"0 0 -4\",rotation:\"-90 0 0\",width:\"4\",height:\"4\",color:\"#7BC8A4\",opacity:\"0.3\"}),/*#__PURE__*/_jsx(\"a-sky\",{color:\"#87CEEB\"}),/*#__PURE__*/_jsx(\"a-entity\",{id:\"cameraRig\",position:\"0 1.6 0\",\"movement-controls\":\"fly: true; constrainToNavMesh: false\",children:/*#__PURE__*/_jsx(\"a-camera\",{\"look-controls\":\"pointerLockEnabled: false\",\"wasd-controls\":\"enabled: false\",cursor:\"rayOrigin: mouse\"})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ar-vr-controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"view-controls\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"control-btn \".concat(currentView==='exterior'?'active':''),onClick:()=>setCurrentView('exterior'),children:\"\\uD83D\\uDCF1\"}),/*#__PURE__*/_jsx(\"button\",{className:\"control-btn \".concat(currentView==='interior'?'active':''),onClick:()=>setCurrentView('interior'),children:\"\\uD83D\\uDD27\"}),/*#__PURE__*/_jsx(\"button\",{className:\"control-btn \".concat(currentView==='exploded'?'active':''),onClick:()=>setCurrentView('exploded'),children:\"\\uD83D\\uDCA5\"})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"exit-btn\",onClick:exitARVR,children:[/*#__PURE__*/_jsx(\"span\",{className:\"btn-icon\",children:\"\\u274C\"}),\"Tho\\xE1t\"]})]}),isARMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"ar-vr-instructions\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDCF1 H\\u01B0\\u1EDBng d\\u1EABn AR:\"}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:\"Hi\\u1EC3n th\\u1ECB marker Hiro tr\\u01B0\\u1EDBc camera\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u0110\\u1EA3m b\\u1EA3o \\xE1nh s\\xE1ng \\u0111\\u1EE7 v\\xE0 marker r\\xF5 r\\xE0ng\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Gi\\u1EEF kho\\u1EA3ng c\\xE1ch 15-30cm t\\u1EEB marker\"}),/*#__PURE__*/_jsx(\"li\",{children:\"M\\xF4 h\\xECnh s\\u1EBD xu\\u1EA5t hi\\u1EC7n tr\\xEAn marker\"})]}),/*#__PURE__*/_jsx(\"p\",{style:{marginTop:'10px',fontSize:'0.9rem',color:'#fbbf24'},children:\"\\uD83D\\uDCA1 \\u0110ang t\\xECm marker... Di chuy\\u1EC3n camera quanh marker Hiro\"})]}),isVRMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"ar-vr-instructions\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83E\\uDD7D H\\u01B0\\u1EDBng d\\u1EABn VR:\"}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:\"Di chuy\\u1EC3n thi\\u1EBFt b\\u1ECB \\u0111\\u1EC3 xem c\\xE1c g\\xF3c \\u0111\\u1ED9 kh\\xE1c nhau\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Ch\\u1EA1m v\\xE0o c\\xE1c b\\u1ED9 ph\\u1EADn \\u0111\\u1EC3 xem th\\xF4ng tin chi ti\\u1EBFt\"}),/*#__PURE__*/_jsx(\"li\",{children:\"S\\u1EED d\\u1EE5ng c\\xE1c n\\xFAt \\u0111\\u1EC3 chuy\\u1EC3n \\u0111\\u1ED5i ch\\u1EBF \\u0111\\u1ED9 xem\"})]})]})]}),isLoading&&/*#__PURE__*/_jsxs(\"div\",{className:\"loading-overlay\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u0110ang kh\\u1EDFi t\\u1EA1o AR...\"})]}),/*#__PURE__*/_jsx(ARGuide,{isOpen:showGuide,onClose:()=>setShowGuide(false)})]});}export default ARViewer;","map":{"version":3,"names":["React","useState","useEffect","useRef","ARGuide","jsxs","_jsxs","jsx","_jsx","ARViewer","_ref","product","isARMode","setIsARMode","isVRMode","setIsVRMode","simple3DMode","setSimple3DMode","currentView","setCurrentView","markerType","setMarkerType","markerPreset","setMarkerPreset","markerPatternUrl","setMarkerPatternUrl","isLoading","setIsLoading","error","setError","objectRotation","setObjectRotation","x","y","librariesLoaded","setLibrariesLoaded","showGuide","setShowGuide","hasCameraPermission","setHasCameraPermission","cameraFacing","setCameraFacing","devices","setDevices","selectedDeviceId","setSelectedDeviceId","showCameraTest","setShowCameraTest","testVideoRef","testStream","checkLibraries","aframeLoaded","window","AFRAME","arjsLoaded","THREEx","ArToolkitSource","console","log","setTimeout","enumerateCameras","devs","navigator","mediaDevices","enumerateDevices","cams","filter","d","kind","length","deviceId","err","warn","startTestPreview","current","constraints","video","exact","facingMode","stream","getUserMedia","srcObject","play","catch","e","message","stopTestPreview","getTracks","forEach","t","stop","arjsConfig","useMemo","parts","push","concat","join","getProductComponents","baseComponents","exterior","name","color","position","z","size","interior","exploded","description","components","currentModelData","startAR","dispatchEvent","Event","_unused","startVR","_unused2","exitARVR","handlePatternFileUpload","event","file","target","files","endsWith","reader","FileReader","onload","dataUrl","result","onerror","readAsDataURL","className","children","onClick","value","onChange","style","marginLeft","type","accept","disabled","map","i","label","padding","v","background","borderRadius","overflow","border","maxWidth","margin","ref","autoPlay","playsInline","muted","width","height","objectFit","component","index","backgroundColor","alt","src","href","rel","embedded","renderer","arjs","modelUrl","id","intensity","rotation","preset","raycaster","emitevents","cursor","pos","depth","class","animation","scale","align","geometry","material","url","camera","opacity","marginTop","fontSize","isOpen","onClose"],"sources":["C:/Users/admin/Download/project-long/cellphones/client-cellphones/src/components/ARViewer/ARViewer.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport ARGuide from '../ARGuide/ARGuide';\r\nimport './ARViewer.css';\r\n\r\nfunction ARViewer({ product }) {\r\n    const [isARMode, setIsARMode] = useState(false);\r\n    const [isVRMode, setIsVRMode] = useState(false);\r\n    const [simple3DMode, setSimple3DMode] = useState(false); // No marker required\r\n    const [currentView, setCurrentView] = useState('exterior');\r\n    const [markerType, setMarkerType] = useState('preset'); // 'preset' or 'pattern'\r\n    const [markerPreset, setMarkerPreset] = useState('hiro');\r\n    const [markerPatternUrl, setMarkerPatternUrl] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [objectRotation, setObjectRotation] = useState({ x: 0, y: 0 });\r\n    const [librariesLoaded, setLibrariesLoaded] = useState(false);\r\n    const [showGuide, setShowGuide] = useState(false);\r\n\r\n    // Camera/device states\r\n    const [hasCameraPermission, setHasCameraPermission] = useState(false);\r\n    const [cameraFacing, setCameraFacing] = useState('environment'); // 'environment' | 'user'\r\n    const [devices, setDevices] = useState([]); // MediaDeviceInfo[]\r\n    const [selectedDeviceId, setSelectedDeviceId] = useState('');\r\n    const [showCameraTest, setShowCameraTest] = useState(false);\r\n    const testVideoRef = useRef(null);\r\n    let testStream = useRef(null);\r\n\r\n    // Check if A-Frame and AR.js are loaded\r\n    useEffect(() => {\r\n        const checkLibraries = () => {\r\n            const aframeLoaded = !!window.AFRAME;\r\n            const arjsLoaded = !!(window.THREEx && window.THREEx.ArToolkitSource);\r\n            \r\n            if (aframeLoaded && arjsLoaded) {\r\n                setLibrariesLoaded(true);\r\n                console.log('AR/VR libraries loaded successfully');\r\n            } else {\r\n                setTimeout(checkLibraries, 100);\r\n            }\r\n        };\r\n        \r\n        checkLibraries();\r\n    }, []);\r\n\r\n    // Enumerate devices after permission granted\r\n    const enumerateCameras = async () => {\r\n        try {\r\n            const devs = await navigator.mediaDevices.enumerateDevices();\r\n            const cams = devs.filter((d) => d.kind === 'videoinput');\r\n            setDevices(cams);\r\n            if (cams.length && !selectedDeviceId) {\r\n                setSelectedDeviceId(cams[0].deviceId);\r\n            }\r\n        } catch (err) {\r\n            console.warn('enumerateDevices failed:', err);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (hasCameraPermission) {\r\n            enumerateCameras();\r\n        }\r\n    }, [hasCameraPermission]);\r\n\r\n    // Toggle simple camera test preview\r\n    const startTestPreview = async () => {\r\n        try {\r\n            if (testStream.current) return; // already running\r\n            const constraints = selectedDeviceId\r\n                ? { video: { deviceId: { exact: selectedDeviceId } } }\r\n                : { video: { facingMode: cameraFacing } };\r\n            const stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n            testStream.current = stream;\r\n            if (testVideoRef.current) {\r\n                testVideoRef.current.srcObject = stream;\r\n                await testVideoRef.current.play().catch(() => {});\r\n            }\r\n        } catch (e) {\r\n            setError('Kh√¥ng m·ªü ƒë∆∞·ª£c camera test: ' + e.message);\r\n        }\r\n    };\r\n\r\n    const stopTestPreview = () => {\r\n        if (testStream.current) {\r\n            testStream.current.getTracks().forEach(t => t.stop());\r\n            testStream.current = null;\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (showCameraTest) startTestPreview(); else stopTestPreview();\r\n        return () => stopTestPreview();\r\n    }, [showCameraTest, selectedDeviceId, cameraFacing]);\r\n\r\n    // Build AR.js attribute string with selected camera/facing\r\n    const arjsConfig = React.useMemo(() => {\r\n        const parts = [\r\n            'sourceType: webcam',\r\n            'debugUIEnabled: true',\r\n            'detectionMode: mono',\r\n            // Keep videoTexture off for max compatibility, let video sit behind canvas\r\n            // 'videoTexture: true',\r\n            'sourceWidth: 1280',\r\n            'sourceHeight: 720',\r\n            'displayWidth: 1280',\r\n            'displayHeight: 720',\r\n        ];\r\n        if (selectedDeviceId) parts.push(`sourceId: ${selectedDeviceId}`);\r\n        if (!selectedDeviceId && cameraFacing) parts.push(`facingMode: ${cameraFacing}`);\r\n        return parts.join('; ');\r\n    }, [selectedDeviceId, cameraFacing]);\r\n\r\n    // L·∫•y th√¥ng tin s·∫£n ph·∫©m th·ª±c t·∫ø t·ª´ props\r\n    const getProductComponents = (product) => {\r\n        const baseComponents = {\r\n            exterior: [\r\n                { name: 'M√†n h√¨nh', color: '#000000', position: { x: 0, y: 0, z: 0 }, size: 40 },\r\n                { name: 'Khung m√°y', color: '#C0C0C0', position: { x: 0, y: 0, z: -1 }, size: 35 },\r\n                { name: 'Camera', color: '#FF0000', position: { x: 0, y: 0.5, z: 0.5 }, size: 15 },\r\n                { name: 'N√∫t ngu·ªìn', color: '#808080', position: { x: 0.3, y: 0, z: 0 }, size: 10 },\r\n                { name: 'Speaker', color: '#333333', position: { x: -0.3, y: 0, z: 0 }, size: 12 }\r\n            ],\r\n            interior: [\r\n                { name: 'CPU', color: '#00FF00', position: { x: 0, y: 0, z: 0 }, size: 25 },\r\n                { name: 'RAM', color: '#0000FF', position: { x: 0.2, y: 0, z: 0 }, size: 20 },\r\n                { name: 'Storage', color: '#FFFF00', position: { x: -0.2, y: 0, z: 0 }, size: 18 },\r\n                { name: 'Battery', color: '#FF00FF', position: { x: 0, y: -0.3, z: 0 }, size: 30 },\r\n                { name: 'Motherboard', color: '#00FFFF', position: { x: 0, y: 0, z: -0.1 }, size: 35 }\r\n            ],\r\n            exploded: [\r\n                { name: 'Screen Assembly', color: '#000000', position: { x: 0, y: 0.5, z: 0 }, size: 45 },\r\n                { name: 'Main Board', color: '#00FF00', position: { x: 0, y: 0, z: 0 }, size: 40 },\r\n                { name: 'Battery Pack', color: '#FF00FF', position: { x: 0, y: -0.5, z: 0 }, size: 35 },\r\n                { name: 'Camera Module', color: '#FF0000', position: { x: 0.3, y: 0.3, z: 0.3 }, size: 15 },\r\n                { name: 'Speaker', color: '#808080', position: { x: -0.3, y: 0.3, z: 0.3 }, size: 12 }\r\n            ]\r\n        };\r\n    \r\n        // N·∫øu ch∆∞a c√≥ product th·∫≠t, d√πng d·ªØ li·ªáu m·∫´u\r\n        if (!product) {\r\n            return {\r\n                name: `${currentView === 'exterior' ? 'Exterior' : currentView === 'interior' ? 'Interior' : 'Exploded'} View`,\r\n                description: `Xem ${currentView === 'exterior' ? 'b√™n ngo√†i' : currentView === 'interior' ? 'b√™n trong' : 'c√°c b·ªô ph·∫≠n t√°ch r·ªùi'} c·ªßa s·∫£n ph·∫©m m·∫´u`,\r\n                components: baseComponents[currentView]\r\n            };\r\n        }\r\n    \r\n        // N·∫øu c√≥ product th·∫≠t\r\n        return {\r\n            name: `${currentView === 'exterior' ? 'Exterior' : currentView === 'interior' ? 'Interior' : 'Exploded'} View`,\r\n            description: `Xem ${currentView === 'exterior' ? 'b√™n ngo√†i' : currentView === 'interior' ? 'b√™n trong' : 'c√°c b·ªô ph·∫≠n t√°ch r·ªùi'} c·ªßa ${product.name}`,\r\n            components: baseComponents[currentView]\r\n        };\r\n    };\r\n\r\n    const currentModelData = getProductComponents(product);\r\n\r\n    const startAR = async () => {\r\n        if (!librariesLoaded) {\r\n            setError('Th∆∞ vi·ªán AR/VR ch∆∞a ƒë∆∞·ª£c t·∫£i. Vui l√≤ng ƒë·ª£i...');\r\n            return;\r\n        }\r\n        // Ensure test preview is stopped so AR.js can access the camera\r\n        if (showCameraTest) {\r\n            setShowCameraTest(false);\r\n            stopTestPreview();\r\n        }\r\n\r\n        setIsLoading(true);\r\n        setError('');\r\n        try {\r\n            const constraints = selectedDeviceId\r\n                ? { video: { deviceId: { exact: selectedDeviceId } } }\r\n                : { video: { facingMode: cameraFacing } };\r\n            const stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n            stream.getTracks().forEach(t => t.stop());\r\n            setHasCameraPermission(true);\r\n            await enumerateCameras();\r\n            setIsARMode(true);\r\n            setIsVRMode(false);\r\n            // Give AR.js a tick to attach video, then force a resize\r\n            setTimeout(() => {\r\n                try { window.dispatchEvent(new Event('resize')); } catch {}\r\n            }, 300);\r\n        } catch (error) {\r\n            if (error.name === 'NotAllowedError') {\r\n                setError('Vui l√≤ng cho ph√©p truy c·∫≠p camera ƒë·ªÉ s·ª≠ d·ª•ng AR');\r\n            } else if (error.name === 'NotFoundError' || error.name === 'OverconstrainedError') {\r\n                setError('Kh√¥ng t√¨m th·∫•y camera ph√π h·ª£p. H√£y th·ª≠ ƒë·ªïi ngu·ªìn camera.');\r\n            } else {\r\n                setError('L·ªói kh·ªüi t·∫°o AR: ' + error.message);\r\n            }\r\n        }\r\n        setIsLoading(false);\r\n    };\r\n\r\n    const startVR = async () => {\r\n        if (!librariesLoaded) {\r\n            setError('Th∆∞ vi·ªán AR/VR ch∆∞a ƒë∆∞·ª£c t·∫£i. Vui l√≤ng ƒë·ª£i...');\r\n            return;\r\n        }\r\n        // Stop camera test if running\r\n        if (showCameraTest) {\r\n            setShowCameraTest(false);\r\n            stopTestPreview();\r\n        }\r\n\r\n        setIsLoading(true);\r\n        setError('');\r\n        try {\r\n            setIsVRMode(true);\r\n            setIsARMode(false);\r\n            setTimeout(() => {\r\n                try { window.dispatchEvent(new Event('resize')); } catch {}\r\n            }, 300);\r\n        } catch (error) {\r\n            setError('L·ªói kh·ªüi t·∫°o VR: ' + error.message);\r\n        }\r\n        setIsLoading(false);\r\n    };\r\n\r\n    const exitARVR = () => {\r\n        setIsARMode(false);\r\n        setIsVRMode(false);\r\n        setError('');\r\n    };\r\n\r\n    const handlePatternFileUpload = (event) => {\r\n        const file = event.target.files && event.target.files[0];\r\n        if (file) {\r\n            if (file.name.endsWith('.patt')) {\r\n                const reader = new FileReader();\r\n                reader.onload = (e) => {\r\n                    const dataUrl = e.target.result;\r\n                    setMarkerPatternUrl(dataUrl);\r\n                    setError('');\r\n                };\r\n                reader.onerror = () => {\r\n                    setError('L·ªói khi ƒë·ªçc file pattern');\r\n                };\r\n                reader.readAsDataURL(file);\r\n            } else {\r\n                setError('Vui l√≤ng ch·ªçn file c√≥ ƒë·ªãnh d·∫°ng .patt');\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"ar-viewer\">\r\n            <div className=\"ar-viewer-header\">\r\n                <h2>AR/VR Viewer - {product?.name || 'S·∫£n ph·∫©m'}</h2>\r\n                <p>Xem c·∫•u tr√∫c thi·∫øt b·ªã v·ªõi c√¥ng ngh·ªá AR/VR</p>\r\n                <button \r\n                    className=\"guide-button\"\r\n                    onClick={() => setShowGuide(true)}\r\n                >\r\n                    üìö H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng\r\n                </button>\r\n            </div>\r\n\r\n            {!librariesLoaded && (\r\n                <div className=\"library-loading\">\r\n                    <div className=\"loading-spinner\"></div>\r\n                    <p>ƒêang t·∫£i th∆∞ vi·ªán AR/VR...</p>\r\n                </div>\r\n            )}\r\n\r\n            {error && (\r\n                <div className=\"error-message\">\r\n                    <span className=\"error-icon\">‚ö†Ô∏è</span>\r\n                    <span>{error}</span>\r\n                </div>\r\n            )}\r\n\r\n            {!isARMode && !isVRMode ? (\r\n                <div className=\"ar-viewer-controls\">\r\n                    <div className=\"view-modes\">\r\n                        <h3>Ch·ªçn ch·∫ø ƒë·ªô xem:</h3>\r\n                        <div className=\"mode-buttons\">\r\n                            <button \r\n                                className={`mode-btn ${currentView === 'exterior' ? 'active' : ''}`}\r\n                                onClick={() => setCurrentView('exterior')}\r\n                            >\r\n                                <span className=\"mode-icon\">üì±</span>\r\n                                B√™n ngo√†i\r\n                            </button>\r\n                            <button \r\n                                className={`mode-btn ${currentView === 'interior' ? 'active' : ''}`}\r\n                                onClick={() => setCurrentView('interior')}\r\n                            >\r\n                                <span className=\"mode-icon\">üîß</span>\r\n                                B√™n trong\r\n                            </button>\r\n                            <button \r\n                                className={`mode-btn ${currentView === 'exploded' ? 'active' : ''}`}\r\n                                onClick={() => setCurrentView('exploded')}\r\n                            >\r\n                                <span className=\"mode-icon\">üí•</span>\r\n                                T√°ch r·ªùi\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"ar-vr-buttons\">\r\n                        <div className=\"marker-controls\">\r\n                            <label>View: </label>\r\n                            <select value={currentView} onChange={(e) => setCurrentView(e.target.value)}>\r\n                                <option value=\"exterior\">Exterior view</option>\r\n                                <option value=\"interior\">Interior view</option>\r\n                                <option value=\"exploded\">Exploded view</option>\r\n                            </select>\r\n\r\n                            <label style={{marginLeft: 12}}>Marker type:</label>\r\n                            <select value={markerType} onChange={(e) => setMarkerType(e.target.value)}>\r\n                                <option value=\"preset\">Preset (hiro)</option>\r\n                                <option value=\"pattern\">Upload pattern (.patt)</option>\r\n                            </select>\r\n\r\n                            {markerType === 'preset' && (\r\n                                <select value={markerPreset} onChange={(e) => setMarkerPreset(e.target.value)}>\r\n                                    <option value=\"hiro\">hiro</option>\r\n                                    <option value=\"kanji\">kanji</option>\r\n                                </select>\r\n                            )}\r\n\r\n                            {markerType === 'pattern' && (\r\n                                <input \r\n                                    type=\"file\" \r\n                                    accept=\".patt\" \r\n                                    onChange={handlePatternFileUpload}\r\n                                />\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Camera controls (helpful for black screen issues) */}\r\n                        <div className=\"marker-controls\">\r\n                            <label>Camera:</label>\r\n                            <select\r\n                                value={selectedDeviceId}\r\n                                onChange={(e) => setSelectedDeviceId(e.target.value)}\r\n                                disabled={!devices.length}\r\n                            >\r\n                                {devices.length === 0 ? (\r\n                                    <option>Kh√¥ng ph√°t hi·ªán camera</option>\r\n                                ) : (\r\n                                    devices.map((d, i) => (\r\n                                        <option key={d.deviceId || i} value={d.deviceId}>\r\n                                            {d.label || `Camera ${i + 1}`}\r\n                                        </option>\r\n                                    ))\r\n                                )}\r\n                            </select>\r\n\r\n                            <label style={{marginLeft: 12}}>H∆∞·ªõng camera:</label>\r\n                            <select value={cameraFacing} onChange={(e) => setCameraFacing(e.target.value)}>\r\n                                <option value=\"environment\">Sau (environment)</option>\r\n                                <option value=\"user\">Tr∆∞·ªõc (user)</option>\r\n                            </select>\r\n\r\n                            <label style={{marginLeft: 12}}>Test camera:</label>\r\n                            <button className=\"ar-btn\" style={{padding: '8px 12px'}} onClick={() => setShowCameraTest(v => !v)}>\r\n                                {showCameraTest ? 'T·∫Øt test' : 'M·ªü test'}\r\n                            </button>\r\n                        </div>\r\n\r\n                        {showCameraTest && (\r\n                            <div style={{background:'#000', borderRadius: 8, overflow:'hidden', border:'1px solid #333', maxWidth: 600, margin:'0 auto'}}>\r\n                                <video ref={testVideoRef} autoPlay playsInline muted style={{width:'100%', height: 300, objectFit:'cover'}} />\r\n                            </div>\r\n                        )}\r\n\r\n                        <button \r\n                            className=\"ar-btn\"\r\n                            onClick={startAR}\r\n                            disabled={isLoading || !librariesLoaded}\r\n                        >\r\n                            <span className=\"btn-icon\">üì∑</span>\r\n                            {isLoading ? 'ƒêang kh·ªüi t·∫°o...' : !librariesLoaded ? 'ƒêang t·∫£i...' : 'B·∫Øt ƒë·∫ßu AR'}\r\n                        </button>\r\n                        <button \r\n                            className=\"vr-btn\"\r\n                            onClick={startVR}\r\n                            disabled={isLoading || !librariesLoaded}\r\n                        >\r\n                            <span className=\"btn-icon\">ü•Ω</span>\r\n                            {!librariesLoaded ? 'ƒêang t·∫£i...' : 'B·∫Øt ƒë·∫ßu VR'}\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"model-preview\">\r\n                        <h3>{currentModelData.name}</h3>\r\n                        <p>{currentModelData.description}</p>\r\n                        <div className=\"components-list\">\r\n                            {currentModelData.components.map((component, index) => (\r\n                                <div key={index} className=\"component-item\">\r\n                                    <div \r\n                                        className=\"component-color\" \r\n                                        style={{ backgroundColor: component.color }}\r\n                                    ></div>\r\n                                    <span>{component.name}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {/* Marker preview and download */}\r\n                        <div className=\"marker-preview\">\r\n                            <h4>Marker d√πng ƒë·ªÉ th·ª≠ (hiro)</h4>\r\n                            <p>In ho·∫∑c hi·ªÉn th·ªã marker n√†y ƒë·ªÉ camera c√≥ th·ªÉ nh·∫≠n di·ªán v√† hi·ªÉn th·ªã m√¥ h√¨nh.</p>\r\n                            <div className=\"marker-image-wrap\">\r\n                                <img alt=\"hiro marker\" src=\"https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png\" style={{width: 150, height: 150, border: '1px solid #ccc'}} />\r\n                            </div>\r\n                            <a className=\"download-marker\" href=\"https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png\" target=\"_blank\" rel=\"noreferrer\">T·∫£i marker (m·ªü ·∫£nh)</a>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            ) : (\r\n                <div className=\"ar-vr-viewport\">\r\n                    {isARMode && (\r\n                        <div className=\"ar-viewport aframe-wrapper\">\r\n                            <a-scene\r\n                                embedded\r\n                                renderer=\"antialias: true; colorManagement: true; alpha: true; precision: medium;\"\r\n                                arjs={arjsConfig}\r\n                                vr-mode-ui=\"enabled: false\"\r\n                                device-orientation-permission-ui=\"enabled: false\"\r\n                            >\r\n                                <a-assets>\r\n                                    {product?.modelUrl && (\r\n                                        <a-asset-item id=\"productModel\" src={product.modelUrl}></a-asset-item>\r\n                                    )}\r\n                                </a-assets>\r\n\r\n                                {/* Add lighting for the scene */}\r\n                                <a-light type=\"ambient\" color=\"#606060\" intensity=\"0.4\"></a-light>\r\n                                <a-light type=\"directional\" position=\"0 1 0\" rotation=\"-90 0 0\" intensity=\"0.6\"></a-light>\r\n\r\n                                {\r\n                                    markerType === 'preset' ? (\r\n                                        <a-marker preset={markerPreset} raycaster=\"objects: .clickable\" emitevents=\"true\" cursor=\"fuse: false; rayOrigin: mouse;\">\r\n                                            {/* Component rendering based on current view */}\r\n                                            <a-entity id=\"phone-model\" position=\"0 0 0\">\r\n                                                {currentModelData.components.map((component, index) => {\r\n                                                    const pos = component.position;\r\n                                                    const size = component.size * 0.01; // Scale down\r\n                                                    return (\r\n                                                        <a-box \r\n                                                            key={index}\r\n                                                            position={`${pos.x} ${pos.y + 0.5} ${pos.z}`}\r\n                                                            width={size}\r\n                                                            height={size}\r\n                                                            depth={size}\r\n                                                            color={component.color}\r\n                                                            class=\"clickable\"\r\n                                                            animation=\"property: rotation; to: 0 360 0; loop: true; dur: 10000\"\r\n                                                        ></a-box>\r\n                                                    );\r\n                                                })}\r\n                                                {product?.modelUrl ? (\r\n                                                    <a-entity gltf-model=\"#productModel\" scale=\"0.5 0.5 0.5\" position=\"0 0 0\"></a-entity>\r\n                                                ) : (\r\n                                                    <a-box position='0 0.5 0' depth='0.4' height='0.6' width='0.3' color='#4CC3D9' rotation='0 45 0'></a-box>\r\n                                                )}\r\n                                                <a-text \r\n                                                    value={`${product?.name || 'S·∫£n ph·∫©m'} - ${currentView}`} \r\n                                                    align=\"center\" \r\n                                                    position=\"0 -0.8 0\" \r\n                                                    color=\"#FFFFFF\" \r\n                                                    width=\"4\"\r\n                                                    geometry=\"primitive: plane; width: 2; height: auto\"\r\n                                                    material=\"color: #000000; opacity: 0.7\"\r\n                                                ></a-text>\r\n                                            </a-entity>\r\n                                        </a-marker>\r\n                                    ) : (\r\n                                        markerPatternUrl ? (\r\n                                            <a-marker type=\"pattern\" url={markerPatternUrl} raycaster=\"objects: .clickable\" emitevents=\"true\">\r\n                                                <a-entity id=\"phone-model\" position=\"0 0 0\">\r\n                                                    {currentModelData.components.map((component, index) => {\r\n                                                        const pos = component.position;\r\n                                                        const size = component.size * 0.01;\r\n                                                        return (\r\n                                                            <a-box \r\n                                                                key={index}\r\n                                                                position={`${pos.x} ${pos.y + 0.5} ${pos.z}`}\r\n                                                                width={size}\r\n                                                                height={size}\r\n                                                                depth={size}\r\n                                                                color={component.color}\r\n                                                                class=\"clickable\"\r\n                                                            ></a-box>\r\n                                                        );\r\n                                                    })}\r\n                                                    {product?.modelUrl ? (\r\n                                                        <a-entity gltf-model=\"#productModel\" scale=\"0.5 0.5 0.5\" position=\"0 0 0\"></a-entity>\r\n                                                    ) : (\r\n                                                        <a-box position='0 0.5 0' depth='0.4' height='0.6' width='0.3' color='#4CC3D9' rotation='0 45 0'></a-box>\r\n                                                    )}\r\n                                                    <a-text \r\n                                                        value={`${product?.name || 'S·∫£n ph·∫©m'} - ${currentView}`} \r\n                                                        align=\"center\" \r\n                                                        position=\"0 -0.8 0\" \r\n                                                        color=\"#FFFFFF\" \r\n                                                        width=\"4\"\r\n                                                    ></a-text>\r\n                                                </a-entity>\r\n                                            </a-marker>\r\n                                        ) : (\r\n                                            <a-entity>\r\n                                                <a-text value=\"Vui l√≤ng upload file .patt ƒë·ªÉ s·ª≠ d·ª•ng marker pattern\" align=\"center\" position=\"0 0 -3\" color=\"#FF0000\" width=\"4\"></a-text>\r\n                                            </a-entity>\r\n                                        )\r\n                                    )\r\n                                }\r\n                                <a-entity camera look-controls-enabled=\"false\" cursor=\"rayOrigin: mouse\"></a-entity>\r\n                            </a-scene>\r\n                        </div>\r\n                    )}\r\n\r\n                    {isVRMode && (\r\n                        <div className=\"vr-viewport aframe-wrapper\">\r\n                            {/* A-Frame VR scene for 3D preview */}\r\n                            <a-scene \r\n                                embedded \r\n                                renderer=\"antialias: true; colorManagement: true; precision: medium;\" \r\n                                background=\"color: #87CEEB\"\r\n                                device-orientation-permission-ui=\"enabled: false\"\r\n                            >\r\n                                <a-assets>\r\n                                    {product?.modelUrl && (\r\n                                        <a-asset-item id=\"productModelVr\" src={product.modelUrl}></a-asset-item>\r\n                                    )}\r\n                                </a-assets>\r\n\r\n                                {/* Lighting */}\r\n                                <a-light type=\"ambient\" color=\"#404040\" intensity=\"0.4\"></a-light>\r\n                                <a-light type=\"directional\" position=\"2 4 5\" intensity=\"0.6\"></a-light>\r\n                                \r\n                                {/* Phone model */}\r\n                                <a-entity id=\"phone-container\" position=\"0 1.6 -3\" rotation=\"0 0 0\">\r\n                                    {currentModelData.components.map((component, index) => {\r\n                                        const pos = component.position;\r\n                                        const size = component.size * 0.02;\r\n                                        return (\r\n                                            <a-box \r\n                                                key={index}\r\n                                                position={`${pos.x} ${pos.y} ${pos.z}`}\r\n                                                width={size}\r\n                                                height={size}\r\n                                                depth={size}\r\n                                                color={component.color}\r\n                                                animation={`property: rotation; to: 0 360 0; loop: true; dur: ${8000 + index * 1000}`}\r\n                                                class=\"clickable\"\r\n                                            ></a-box>\r\n                                        );\r\n                                    })}\r\n                                    \r\n                                    {/* Product name */}\r\n                                    <a-text \r\n                                        value={`${product?.name || 'S·∫£n ph·∫©m'} - ${currentView} View`} \r\n                                        align=\"center\" \r\n                                        position=\"0 -1 0\" \r\n                                        color=\"#FFFFFF\" \r\n                                        width=\"6\"\r\n                                        geometry=\"primitive: plane; width: 3; height: auto\"\r\n                                        material=\"color: #000000; opacity: 0.8\"\r\n                                    ></a-text>\r\n                                </a-entity>\r\n\r\n                                {/* Environment */}\r\n                                <a-plane position=\"0 0 -4\" rotation=\"-90 0 0\" width=\"4\" height=\"4\" color=\"#7BC8A4\" opacity=\"0.3\"></a-plane>\r\n                                <a-sky color=\"#87CEEB\"></a-sky>\r\n                                \r\n                                {/* Camera with movement controls */}\r\n                                <a-entity \r\n                                    id=\"cameraRig\" \r\n                                    position=\"0 1.6 0\"\r\n                                    movement-controls=\"fly: true; constrainToNavMesh: false\"\r\n                                >\r\n                                    <a-camera \r\n                                        look-controls=\"pointerLockEnabled: false\"\r\n                                        wasd-controls=\"enabled: false\"\r\n                                        cursor=\"rayOrigin: mouse\"\r\n                                    ></a-camera>\r\n                                </a-entity>\r\n                            </a-scene>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"ar-vr-controls\">\r\n                        <div className=\"view-controls\">\r\n                            <button \r\n                                className={`control-btn ${currentView === 'exterior' ? 'active' : ''}`}\r\n                                onClick={() => setCurrentView('exterior')}\r\n                            >\r\n                                üì±\r\n                            </button>\r\n                            <button \r\n                                className={`control-btn ${currentView === 'interior' ? 'active' : ''}`}\r\n                                onClick={() => setCurrentView('interior')}\r\n                            >\r\n                                üîß\r\n                            </button>\r\n                            <button \r\n                                className={`control-btn ${currentView === 'exploded' ? 'active' : ''}`}\r\n                                onClick={() => setCurrentView('exploded')}\r\n                            >\r\n                                üí•\r\n                            </button>\r\n                        </div>\r\n                        \r\n                        <button className=\"exit-btn\" onClick={exitARVR}>\r\n                            <span className=\"btn-icon\">‚ùå</span>\r\n                            Tho√°t\r\n                        </button>\r\n                    </div>\r\n\r\n                    {isARMode && (\r\n                        <div className=\"ar-vr-instructions\">\r\n                            <h4>üì± H∆∞·ªõng d·∫´n AR:</h4>\r\n                            <ul>\r\n                                <li>Hi·ªÉn th·ªã marker Hiro tr∆∞·ªõc camera</li>\r\n                                <li>ƒê·∫£m b·∫£o √°nh s√°ng ƒë·ªß v√† marker r√µ r√†ng</li>\r\n                                <li>Gi·ªØ kho·∫£ng c√°ch 15-30cm t·ª´ marker</li>\r\n                                <li>M√¥ h√¨nh s·∫Ω xu·∫•t hi·ªán tr√™n marker</li>\r\n                            </ul>\r\n                            <p style={{marginTop: '10px', fontSize: '0.9rem', color: '#fbbf24'}}>\r\n                                üí° ƒêang t√¨m marker... Di chuy·ªÉn camera quanh marker Hiro\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n\r\n                    {isVRMode && (\r\n                        <div className=\"ar-vr-instructions\">\r\n                            <h4>ü•Ω H∆∞·ªõng d·∫´n VR:</h4>\r\n                            <ul>\r\n                                <li>Di chuy·ªÉn thi·∫øt b·ªã ƒë·ªÉ xem c√°c g√≥c ƒë·ªô kh√°c nhau</li>\r\n                                <li>Ch·∫°m v√†o c√°c b·ªô ph·∫≠n ƒë·ªÉ xem th√¥ng tin chi ti·∫øt</li>\r\n                                <li>S·ª≠ d·ª•ng c√°c n√∫t ƒë·ªÉ chuy·ªÉn ƒë·ªïi ch·∫ø ƒë·ªô xem</li>\r\n                            </ul>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {isLoading && (\r\n                <div className=\"loading-overlay\">\r\n                    <div className=\"loading-spinner\"></div>\r\n                    <p>ƒêang kh·ªüi t·∫°o AR...</p>\r\n                </div>\r\n            )}\r\n\r\n            <ARGuide isOpen={showGuide} onClose={() => setShowGuide(false)} />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ARViewer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}