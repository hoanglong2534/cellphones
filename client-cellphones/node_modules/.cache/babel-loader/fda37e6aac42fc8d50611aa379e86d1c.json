{"ast":null,"code":"var _jsxFileName = \"D:\\\\STUDY\\\\PTIT\\\\NAM_4\\\\KI_1\\\\LT_WEB\\\\BTL_GiuaKy\\\\cellphons\\\\client-cellphones\\\\src\\\\components\\\\Admin\\\\components\\\\AppChat\\\\Chat\\\\Chat.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport axios from \"axios\";\nimport io from \"socket.io-client\";\nimport { useSelector } from \"react-redux\";\nimport ListMessage from \"./ListMessage\";\nimport TypeMessage from \"./TypeMessage\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Chat(props) {\n  _s();\n  let socket;\n  const ENDPOINT = \"localhost:5000\";\n  const [messages, setMessages] = useState([]);\n  const {\n    userInfo\n  } = useSelector(state => state.userSignin);\n  const idConversation = useSelector(state => state.chat.idConversation);\n  const nameConversation = useSelector(state => state.chat.nameConversation);\n  useEffect(() => {\n    if (!idConversation) return;\n    const getAllMessageByConversation = async () => {\n      const {\n        data\n      } = await axios.get(\"http://localhost:4000/chat/message?idConversation=\".concat(idConversation));\n      setMessages(data.messageList);\n    };\n    getAllMessageByConversation();\n  }, [idConversation]);\n  useEffect(() => {\n    socket = io(ENDPOINT);\n    socket.emit(\"admin_join_conversation\", idConversation);\n    socket.on(\"newMessage\", message => {\n      setMessages([...messages, message]);\n    });\n    return () => socket.disconnect();\n  });\n  useEffect(() => {\n    const scrollMessage = () => {\n      var element = document.querySelector(\".ad-chatuser-listmessage\");\n      element.scrollTop = element.scrollHeight;\n    };\n    scrollMessage();\n  });\n  const handleFormSubmit = async message => {\n    const sender = userInfo.name;\n    const payload = {\n      sender,\n      message,\n      idConversation\n    };\n    const {\n      data\n    } = await axios.post(\"http://localhost:4000/chat/save\", payload);\n    socket.emit('chat', data);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"ad-chatuser\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ad-chatuser-user\",\n      children: /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"ad-chatuser-user-name\",\n        children: nameConversation\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 9\n    }, this), messages ? /*#__PURE__*/_jsxDEV(ListMessage, {\n      messages: messages,\n      user: userInfo\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 11\n    }, this) : \"\", /*#__PURE__*/_jsxDEV(TypeMessage, {\n      onSubmit: handleFormSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 7\n  }, this);\n}\n_s(Chat, \"A/VuqG0GZ3ISvKYWRTQTZKzkgD0=\", false, function () {\n  return [useSelector, useSelector, useSelector];\n});\n_c = Chat;\nexport default Chat;\nvar _c;\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"names":["React","useEffect","useState","axios","io","useSelector","ListMessage","TypeMessage","jsxDEV","_jsxDEV","Chat","props","_s","socket","ENDPOINT","messages","setMessages","userInfo","state","userSignin","idConversation","chat","nameConversation","getAllMessageByConversation","data","get","concat","messageList","emit","on","message","disconnect","scrollMessage","element","document","querySelector","scrollTop","scrollHeight","handleFormSubmit","sender","name","payload","post","className","children","fileName","_jsxFileName","lineNumber","columnNumber","user","onSubmit","_c","$RefreshReg$"],"sources":["D:/STUDY/PTIT/NAM_4/KI_1/LT_WEB/BTL_GiuaKy/cellphons/client-cellphones/src/components/Admin/components/AppChat/Chat/Chat.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport io from \"socket.io-client\";\r\nimport { useSelector } from \"react-redux\";\r\nimport ListMessage from \"./ListMessage\";\r\nimport TypeMessage from \"./TypeMessage\";\r\n\r\nfunction Chat(props) {\r\n  let socket;\r\n  const ENDPOINT = \"localhost:5000\";\r\n  const [messages, setMessages] = useState([]);\r\n  const { userInfo } = useSelector((state) => state.userSignin);\r\n  const idConversation = useSelector((state) => state.chat.idConversation);\r\n  const nameConversation = useSelector(state => state.chat.nameConversation)\r\n\r\n  useEffect(() => {\r\n    if (!idConversation) return;\r\n    const getAllMessageByConversation = async () => {\r\n      const { data } = await axios.get(\r\n        `http://localhost:4000/chat/message?idConversation=${idConversation}`\r\n      );\r\n      setMessages(data.messageList);\r\n    };\r\n\r\n    getAllMessageByConversation();\r\n  }, [idConversation]);\r\n\r\n  useEffect(() => {\r\n    socket = io(ENDPOINT);\r\n\r\n    socket.emit(\"admin_join_conversation\", idConversation);\r\n\r\n    socket.on(\"newMessage\", (message) => {\r\n      setMessages([...messages, message]);\r\n    });\r\n\r\n    return () => socket.disconnect();\r\n  });\r\n\r\n  useEffect(() => {\r\n    const scrollMessage = () => {\r\n      var element = document.querySelector(\".ad-chatuser-listmessage\");\r\n      element.scrollTop = element.scrollHeight;\r\n    }\r\n    \r\n      scrollMessage()\r\n\r\n  })\r\n\r\n  const handleFormSubmit = async (message) => {\r\n    const sender = userInfo.name;\r\n\r\n    const payload = {\r\n      sender,\r\n      message,\r\n      idConversation,\r\n    };\r\n    const { data } = await axios.post(\r\n      \"http://localhost:4000/chat/save\",\r\n      payload\r\n    );\r\n    socket.emit('chat', data);\r\n  };\r\n  return (\r\n   \r\n      <div className=\"ad-chatuser\">\r\n        <div className=\"ad-chatuser-user\">\r\n          <span className=\"ad-chatuser-user-name\">{nameConversation}</span>\r\n        </div>\r\n\r\n        {messages ? (\r\n          <ListMessage messages={messages} user={userInfo}></ListMessage>\r\n        ) : (\r\n          \"\"\r\n        )}\r\n\r\n        <TypeMessage onSubmit={handleFormSubmit}></TypeMessage>\r\n      </div>\r\n      \r\n   \r\n  );\r\n}\r\n\r\nexport default Chat;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}