{"ast":null,"code":"var _jsxFileName = \"D:\\\\STUDY\\\\PTIT\\\\NAM_4\\\\KI_1\\\\LT_WEB\\\\BTL_GiuaKy\\\\cellphons\\\\client-cellphones\\\\src\\\\components\\\\AppChat\\\\AppChat.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport io from \"socket.io-client\";\nimport { useSelector } from \"react-redux\";\nimport axios from \"axios\";\nimport ListMessage from \"./Components/ListMessage.js/ListMessage\";\nimport TypeMessage from \"./Components/TypeMessage/TypeMessage\";\nimport './AppChat.css';\nimport { LineOutlined } from '@ant-design/icons';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet socket;\nfunction AppChat(props) {\n  _s();\n  const ENDPOINT = \"http://localhost:4000\";\n  const [messages, setMessages] = useState([]);\n  const [openChat, setOpenChat] = useState(false);\n  const {\n    userInfo\n  } = useSelector(state => state.userSignin);\n  useEffect(() => {\n    const getAllMessageByConversation = async () => {\n      const {\n        data\n      } = await axios.get(\"http://localhost:4000/chat/message?idUser=\".concat(userInfo._id));\n      setMessages(data.messageList);\n    };\n    getAllMessageByConversation();\n  }, []);\n  useEffect(() => {\n    socket = io(ENDPOINT);\n    socket.emit('join_conversation', userInfo._id);\n    //setup response\n    socket.on('newMessage', message => {\n      setMessages([...messages, message]);\n    });\n\n    // disconnect ||cleanup the effect\n    // return () => socket.disconnect();\n    // eslint-disable-next-line\n  }, [messages]);\n  useEffect(() => {\n    const scrollMessage = () => {\n      var element = document.querySelector(\".chatuser-listmessage\");\n      element.scrollTop = element.scrollHeight;\n    };\n    if (openChat) {\n      scrollMessage();\n    }\n  });\n  const handleChatFormSubmit = async message => {\n    const sender = userInfo.name;\n\n    //emit create conversation and chat\n    if (messages.length === 0) {\n      socket.emit('create_conversation', userInfo);\n      socket.on('response_room', async conversation => {\n        const payload = {\n          sender,\n          message,\n          idConversation: conversation._id\n        };\n        const {\n          data\n        } = await axios.post('http://localhost:4000/chat/save', payload);\n        socket.emit('chat', data);\n      });\n    } else {\n      const idConversation = messages[0].idConversation._id || messages[0].idConversation;\n      // request save message\n      const payload = {\n        sender,\n        message,\n        idConversation\n      };\n      const {\n        data\n      } = await axios.post('http://localhost:4000/chat/save', payload);\n      socket.emit('chat', data);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"appchat\",\n    children: [openChat ? '' : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"openchat\",\n      onClick: () => setOpenChat(!openChat),\n      children: \"Chat v\\u1EDBi nh\\xE2n vi\\xEAn\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 11\n    }, this), openChat ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chatuser\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chatuser-user\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chatuser-user-name\",\n          children: \"Cao Kha Hieu\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chatuser-user-line\",\n          onClick: () => setOpenChat(!openChat),\n          children: /*#__PURE__*/_jsxDEV(LineOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 87\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, this), messages ? /*#__PURE__*/_jsxDEV(ListMessage, {\n        messages: messages,\n        user: userInfo\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 23\n      }, this) : '', /*#__PURE__*/_jsxDEV(TypeMessage, {\n        onSubmit: handleChatFormSubmit\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 21\n    }, this) : '']\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 85,\n    columnNumber: 3\n  }, this);\n}\n_s(AppChat, \"tGGHVAhaf1LlT7FgJngOtQY8dUQ=\", false, function () {\n  return [useSelector];\n});\n_c = AppChat;\nexport default AppChat;\nvar _c;\n$RefreshReg$(_c, \"AppChat\");","map":{"version":3,"names":["React","useEffect","useState","io","useSelector","axios","ListMessage","TypeMessage","LineOutlined","jsxDEV","_jsxDEV","socket","AppChat","props","_s","ENDPOINT","messages","setMessages","openChat","setOpenChat","userInfo","state","userSignin","getAllMessageByConversation","data","get","concat","_id","messageList","emit","on","message","scrollMessage","element","document","querySelector","scrollTop","scrollHeight","handleChatFormSubmit","sender","name","length","conversation","payload","idConversation","post","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","user","onSubmit","_c","$RefreshReg$"],"sources":["D:/STUDY/PTIT/NAM_4/KI_1/LT_WEB/BTL_GiuaKy/cellphons/client-cellphones/src/components/AppChat/AppChat.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport io from \"socket.io-client\";\r\nimport { useSelector } from \"react-redux\";\r\nimport axios from \"axios\";\r\nimport ListMessage from \"./Components/ListMessage.js/ListMessage\";\r\nimport TypeMessage from \"./Components/TypeMessage/TypeMessage\";\r\nimport './AppChat.css'\r\nimport { LineOutlined } from '@ant-design/icons';\r\n\r\nlet socket;\r\n\r\nfunction AppChat(props) {\r\n  const ENDPOINT = \"http://localhost:4000\";\r\n  const [messages, setMessages] = useState([]);\r\n  const [openChat, setOpenChat] = useState(false)\r\n  const { userInfo } = useSelector((state) => state.userSignin)\r\n\r\n  useEffect(() => {\r\n    const getAllMessageByConversation = async () => {\r\n      const {data}  = await axios.get(\r\n        `http://localhost:4000/chat/message?idUser=${userInfo._id}`\r\n      );\r\n      setMessages(data.messageList);\r\n    }\r\n\r\n    getAllMessageByConversation()\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n\r\n    socket = io(ENDPOINT);\r\n\r\n    socket.emit('join_conversation', userInfo._id);\r\n    //setup response\r\n    socket.on('newMessage', (message) => {\r\n      setMessages([...messages, message]);\r\n    });\r\n\r\n    // disconnect ||cleanup the effect\r\n    // return () => socket.disconnect();\r\n    // eslint-disable-next-line\r\n  }, [messages]);\r\n\r\n  useEffect(() => {\r\n    const scrollMessage = () => {\r\n      var element = document.querySelector(\".chatuser-listmessage\");\r\n      element.scrollTop = element.scrollHeight;\r\n    }\r\n    if(openChat){\r\n      scrollMessage()\r\n    }\r\n  })\r\n\r\n  const handleChatFormSubmit = async (message) => {\r\n    const sender = userInfo.name;\r\n\r\n    //emit create conversation and chat\r\n    if (messages.length === 0) {\r\n      socket.emit('create_conversation', userInfo);\r\n\r\n      socket.on('response_room', async (conversation) => {\r\n        const payload = {\r\n          sender,\r\n          message,\r\n          idConversation: conversation._id,\r\n        };\r\n        const {data} = await axios.post('http://localhost:4000/chat/save', payload);\r\n        socket.emit('chat', data);\r\n      });\r\n    } else {\r\n      const idConversation = messages[0].idConversation._id || messages[0].idConversation;\r\n      // request save message\r\n      const payload = {\r\n        sender,\r\n        message,\r\n        idConversation,\r\n      };\r\n      const {data} = await axios.post('http://localhost:4000/chat/save', payload)\r\n      socket.emit('chat', data);\r\n    } \r\n  };\r\n\r\n  \r\n  return (\r\n  <div className=\"appchat\">\r\n      \r\n      {\r\n        openChat ? '' : (\r\n          <div className=\"openchat\" onClick={() => setOpenChat(!openChat)}>\r\n            Chat với nhân viên\r\n          </div>\r\n        )\r\n      }\r\n      \r\n      {\r\n        openChat ? (<div className=\"chatuser\">\r\n        <div className=\"chatuser-user\">\r\n          <span className=\"chatuser-user-name\">Cao Kha Hieu</span>\r\n          <span className=\"chatuser-user-line\" onClick={() => setOpenChat(!openChat)}><LineOutlined></LineOutlined></span>\r\n        </div>\r\n\r\n        {\r\n          messages ? (<ListMessage messages={messages} user={userInfo}></ListMessage>) : ''\r\n        }\r\n\r\n      <TypeMessage onSubmit={handleChatFormSubmit} ></TypeMessage>\r\n\r\n      </div>) : ''\r\n      }\r\n  </div>);\r\n}\r\n\r\nexport default AppChat;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}